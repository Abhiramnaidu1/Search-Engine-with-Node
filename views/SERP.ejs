<%- include('partials/header') %>
<div class="form-container">
  <div align="right" class="form-group">

      <button class="btn btn-info"> <a href="/register"  >Register </a></button>
      <button class="btn btn-warning" type="button">  <a href="/login"  >Login</a></button>
  </div>

    <h2>Search Engine</h2>
    <% if(locals.error) { %>
        <div class="alert alert-danger"><%= error %></div>
    <% } %>
    <% if(locals.success) { %>
        <div class="alert alert-success"><%= success %></div>
    <% } %>

        <div class="form-group">

            <input type="text" placeholder="search a book" id="title" class="form-control" />
            <button type="button" class="btn btn-primary" onclick="searchTitles()" name="button">Go</button>
        </div>
        </div>

<div class="col-lg-12 doc-middle-content">
  <strong>
  <div class="titles">

  </div>
  <div class="count">

  </div>

  <p>Matching Results</p>
  <div class="pagination">


  <div class = "results1"> </div>
    <div class="mt-3"> <a data-toggle="collapse" href="#collapseExample" role="button"  aria-expanded="false" aria-controls="collapseExample"> Page 1 <i class="fa fa-angle-down"></i> </a>
      <div class="collapse" id="collapseExample">
        <div class="card card-body">

            <div class="col-md-4 results1"> </div>

        </div>
      </div>
    </div>

    <!-- <div  class="mt-3">
<ul >
<a data-toggle="collapse"  role="button" aria-expanded="false" aria-controls="collapseExample">page 1 <i class="fa fa-angle-down"></i> </a>
  <li class="results1"></li></ul>
  <li class="results2">page 2</li>
  <li class="results3">page 3</li>


    </div> -->

  </div>
</div>


</strong>


<script type="text/javascript">

    window.onload=  function searchTitles(){

    var title = localStorage.getItem('title');

    console.log('serp',title);
    var userObj={
      'title': title

    }
    var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          // window.location.href='/index';
           // document.getElementById("demo").innerHTML = this.responseText;
          console.log(this.responseText);
          var response=JSON.parse(this.responseText);
          var hits=response.hits.hits;
          var results1=document.getElementsByClassName('results1')[0];
          var results2=document.getElementsByClassName('results2')[0];
          var results3=document.getElementsByClassName('results3')[0];

          var titles = document.getElementsByClassName('titles')[0];
          titles.innerHTML='<p> searching for: '+userObj.title+'</p>';
          var k=1;
          var count=response.hits.total.value;
          var counts=document.getElementsByClassName('count')[0]
          counts.setAttribute('class','item');
          counts.innerHTML='<p>'+'Total matches:'+count+'</p>';

          for (var i in hits ){

            var div=document.createElement('div');
            console.log(userObj.title);

            div.setAttribute('class','item');
            div.innerHTML='<p>'+k+') '+'<a href=/api/users/getbook/'+hits[i]._id+'>'+hits[i]._source.title+'\n'+'</a></p>';


            if(k<11){
            results1.appendChild(div);
          }

          if(k>11 && k<21){
            results2.appendChild(div);
          }
       if(k>21 &&k<31){
      results3.appendChild(div);
    }
    if(k>31 &&k<41){
   results3.appendChild(div);
 }
 if(k>41 &&k<51){
results3.appendChild(div);
}
if(k>51 &&k<61){
results3.appendChild(div);
}
if(k>61 &&k<71){
results3.appendChild(div);
}
      k+=1;
       }

          var data = pagination(dataset,1,10);
          console.log('Data: ',data)

        }
  };

      xhttp.open("GET", "/api/users/search?title="+title, true);
     xhttp.setRequestHeader("Content-type", "application/json");
    xhttp.send();

}


function searchTitles(){
  var Title = document.getElementById("title").value;
var titlestrip = Title.replace(/(<([^>]+)>)/gi, "");
localStorage.setItem('title',titlestrip);
   window.location.href='/api/users/serp';
 }


function pagination(queryset,page, rows){
  var trimstart = (page -1)* rows
  var trimend = trimstart + rows
  var trimmed = queryset.slice(trimstart,trimend)
  var pages = Math.ceil(queryset.length /rows)
  return{
    'queryset': trimmed,
    'pages' : pages
  }
}
</script>

<%- include('partials/footer') %>
