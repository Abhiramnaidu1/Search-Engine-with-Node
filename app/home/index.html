
<h1>Hi {{vm.user.firstName}}!!</h1>
<h1 align="center">SEARCH ENGINE</h1>

<div class="form-group" >
     <input type ="text" id="title" class="col-md-6" align="center" placeholder = "Search here">

     <button class="btn btn-primary" onclick="advsearch()" type="submit" name="button">go</button>
     <!-- <button class ="search-btn" type="button"> </button> -->
     </div>
     <!-- <div class="form-group">
     <button class="btn btn-primary" type="button" name="button">Advanced Search</button>
     </div> -->
     <div class="mt-3"> <a data-toggle="collapse" href="#collapseExample" role="button"id =title aria-expanded="false" aria-controls="collapseExample" class="advanced"> Advance Search With Filters <i class="fa fa-angle-down"></i> </a>
                         <div class="collapse" id="collapseExample">
                             <div class="card card-body">
                                 <div class="row">
                                     <div class="col-md-4"> <input type="text" id ="Description" placeholder="Search in description" class="form-control"> </div>
                                     <div class="col-md-4"> <input type="text" id="Author" class="form-control" placeholder="Search by Author"> </div>
                                     <div class="col-md-4"> <input type="text" id ="Department" class="form-control" placeholder="Search by Departmrnt"> </div>
                                 </div>
                             </div>
                         </div>
                     </div>
                     <strong>
                     <div class="titles">

                     </div>
                     <div class="count">

                     </div>


                     <div class="results">

                     </div>
</strong>
                     <script type="text/javascript">
                           function advsearch(){
                             var userObj={
                            title:document.getElementById("title").value,
                            Description:document.getElementById("Description").value,
                             Author:document.getElementById("Author").value,
                            Department:document.getElementById("Department").value
                           }
                          var token=window.jwtToken;
                           if(token==undefined){
                             window.location.href = '/login';
                           }
                           var xhttp = new XMLHttpRequest();
                             xhttp.onreadystatechange = function() {
                               if (this.readyState == 4 && this.status == 200) {
                                 // window.location.href='/index';
                                  // document.getElementById("demo").innerHTML = this.responseText;
                                 console.log(this.responseText);
                                 var response=JSON.parse(this.responseText);
                                 var hits=response.hits.hits;
                                 var results=document.getElementsByClassName('results')[0];
                                 results.innerHTML="";

                                 var titles = document.getElementsByClassName('titles')[0];
                                 titles.innerHTML='<p> Searching for: '+userObj.title+'</p>';
                                 var k=1;
                                 var count=response.hits.total.value;
                                 var counts=document.getElementsByClassName('count')[0];

                                 counts.innerHTML='<p>'+'Total matches:'+count+'<br /> Matching Results:</p>';
                                 for (var i in hits){
                                   var div=document.createElement('div');


                                   div.setAttribute('class','item');
                                   div.innerHTML='<p>'+k+') '+'<a href=/api/users/getbook/'+hits[i]._id+'>'+hits[i]._source.title+'\n'+'</a></p>';
                                   k+=1;
                                   results.appendChild(div);
                                 }

                               }
                         };

                             xhttp.open("POST", "/api/users/advsearch", true);
                            xhttp.setRequestHeader("Content-type", "application/json");
                           xhttp.setRequestHeader("Authorization","Bearer "+token);
                           xhttp.send(JSON.stringify(userObj));



                            }


                              </script>
